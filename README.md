# 豆瓣影视更新系统

## 项目概述

豆瓣影视更新系统是一个用于自动化管理豆瓣账号并进行影视内容更新的工具。该系统提供了完整的账号管理、浏览器自动化、IP定位、内容发布等功能，支持多账号、多分组管理，具有Fluent Design风格的现代化UI界面。

## 核心功能模块

### 1. 账号管理模块

#### 主要功能：
- **账号分组管理**：支持创建、删除分组，账号按分组分类管理
- **账号增删改查**：支持添加、编辑、删除账号，以及查看账号详细信息
- **批量操作**：支持全选、取消全选、批量删除账号
- **代理设置**：支持为账号添加和删除代理设置
- **状态监控**：显示账号登录状态、运行状态等信息

#### 界面元素：
- 左侧分组管理区域：显示分组列表，提供添加/删除分组按钮
- 右侧账号表格：显示13列账号信息（ID、用户名、密码、CK、昵称、账号ID、登录状态、主页、登录时间、代理、运行状态、备注、分组）
- 操作按钮：全选、取消全选、添加账号、编辑账号、删除账号、打开浏览器等

### 2. 电影管理模块

#### 主要功能：
- **指定电影管理**：管理需要评分的特定电影列表
- **随机电影管理**：管理用于随机评分的电影列表
- **批量操作**：支持添加、删除、批量删除、清空电影数据

#### 界面元素：
- 指定电影表格：显示电影ID和评分
- 随机电影表格：显示电影ID和评分
- 操作按钮：添加电影、删除电影、批量删除、清空指定电影、清空随机电影、清空所有电影

### 3. 内容管理模块

#### 主要功能：
- **指定内容管理**：管理需要发布的特定内容列表
- **随机内容管理**：管理用于随机发布的内容列表
- **批量操作**：支持添加、删除、批量删除、清空内容数据

#### 界面元素：
- 指定内容表格：显示内容文本
- 随机内容表格：显示内容文本
- 操作按钮：添加内容、删除内容、批量删除、清空指定内容、清空随机内容、清空所有内容

### 4. 功能设置模块

#### 主要功能：
- **功能开关设置**：控制签名、说说、小组、短语等功能的启用状态
- **间隔设置**：配置操作间隔、换号间隔、错误间隔等参数
- **评星设置**：设置电影评分的星级范围
- **运行设置**：配置运行相关的参数

#### 界面元素：
- 复选框：签名发布、说说发布、小组发布、短语发布
- 输入框：操作间隔、换号间隔、错误间隔
- 下拉框：评星设置
- 文本框：输入内容区域

### 5. 操作设置模块

#### 主要功能：
- 待实现的功能模块

### 6. 程序设置模块

#### 主要功能：
- **浏览器配置**：设置浏览器路径和缓存路径
- **路径浏览**：支持浏览选择浏览器和缓存目录
- **自动检测**：自动检测系统中安装的浏览器路径

#### 界面元素：
- 浏览器路径输入框及浏览按钮
- 缓存路径输入框及浏览按钮

### 7. 浏览器自动化模块

#### 主要功能：
- **浏览器实例管理**：创建和管理浏览器实例
- **指纹应用**：为浏览器应用特定的指纹信息
- **页面操作**：打开网页、执行JavaScript脚本
- **状态监控**：监控浏览器运行状态
- **资源清理**：关闭浏览器并清理相关资源

#### 技术实现：
- 使用Playwright进行浏览器自动化
- 支持Chrome、Edge等主流浏览器
- 支持代理设置
- 支持多账号并发操作

### 8. IP定位模块

#### 主要功能：
- **IP地理位置获取**：通过API获取IP地址对应的地理位置信息
- **多接口支持**：支持IP-API和IPSHU两个定位接口
- **自动切换**：当主接口失败时自动切换到备用接口

### 9. 右键菜单模块

#### 主要功能：
- **Fluent Design风格**：现代化的右键菜单设计
- **快捷操作**：提供打开浏览器、编辑账号、删除账号等快捷功能
- **信息复制**：支持复制用户名和密码

### 10. 数据库管理模块

#### 主要功能：
- **SQLite数据库**：使用SQLite存储所有数据
- **数据表结构**：包含分组表、账号表、电影表、内容表
- **数据操作**：提供完整的增删改查接口
- **事务处理**：支持数据库事务确保数据一致性

#### 数据表结构：
- **分组表(groups)**：存储分组信息
- **账号表(accounts)**：存储账号详细信息
- **电影表(movies)**：存储电影ID和评分信息
- **内容表(contents)**：存储发布内容信息

### 11. 配置管理模块

#### 主要功能：
- **路径管理**：统一管理系统中使用的各种路径
- **系统兼容**：支持Windows、macOS、Linux系统
- **目录初始化**：自动创建必要的目录结构

#### 目录结构：
- 数据目录(data)：存储数据库和配置文件
- 日志目录(logs)：存储程序日志
- 缓存目录(cache)：存储浏览器缓存
- 临时目录(temp)：存储临时文件
- 备份目录(backup)：存储备份文件

### 12. 日志管理模块

#### 主要功能：
- **日志记录**：记录程序运行日志
- **文件输出**：将日志写入文件
- **控制台输出**：在控制台显示重要日志
- **日志级别控制**：区分不同级别的日志信息

## UI设计特色

### Fluent Design风格
系统采用现代化的Fluent Design设计语言，具有以下特点：
- 圆角设计
- 柔和的色彩搭配
- 清晰的视觉层次
- 一致的交互体验

### 响应式布局
界面支持不同屏幕尺寸的适配，确保在各种设备上都有良好的显示效果。

## 系统架构

### 技术栈
- **编程语言**：Python 3.x
- **GUI框架**：PySide6 (Qt)
- **浏览器自动化**：Playwright
- **数据库**：SQLite
- **打包工具**：PyInstaller (支持exe打包)

### 模块化设计
系统采用模块化设计，各功能模块相对独立，便于维护和扩展：
- 主窗口模块(main.py)
- 浏览器模块(mokuai_liulanqi.py)
- 数据库管理模块(database_manager.py)
- 配置管理模块(config.py)
- 工具模块(utils.py)
- 样式模块(styles.py)
- 右键菜单模块(right_click_menu.py)
- IP定位模块(mokuai_ipdingwei.py)

## 部署与运行

### 运行环境
- Windows 7及以上版本
- Python 3.7及以上版本（开发环境）
- 支持打包为exe文件直接运行

### 构建exe文件
要将程序打包为exe文件，可以运行以下命令：
```bash
python build.py
```

该命令会自动安装PyInstaller（如果尚未安装），然后使用PyInstaller将程序打包为exe文件。构建完成后，exe文件将位于`dist`目录中。

注意：构建过程可能需要一些时间，具体取决于系统性能。

### 目录结构
```
豆瓣影视更新/
├── data/           # 数据目录
├── logs/           # 日志目录
├── cache/          # 缓存目录
├── temp/           # 临时目录
├── backup/         # 备份目录
├── main.py         # 主程序入口
├── run.py          # 启动脚本
├── 启动程序.bat     # Windows启动批处理文件
├── database_manager.py  # 数据库管理
├── config.py       # 配置管理
├── utils.py        # 工具模块
├── styles.py       # 样式定义
├── right_click_menu.py  # 右键菜单
├── mokuai_liulanqi.py   # 浏览器模块
└── mokuai_ipdingwei.py  # IP定位模块
```

### 运行程序

可以通过以下任一方式运行程序：

1. 直接运行主程序：
```bash
python main.py
```

2. 使用启动脚本（推荐）：
```bash
python run.py
```

3. 在Windows系统上，也可以双击`启动程序.bat`文件来运行程序。该批处理文件会自动创建必要的目录并启动程序。

4. 如果系统中已正确安装Python环境，也可以通过运行`start_app.bat`文件来启动程序。该批处理文件会设置Qt插件路径并启动主程序。

## 安全性考虑

- 数据库存储账号信息
- 支持代理设置保护隐私
- 日志记录便于问题追踪
- 数据备份机制